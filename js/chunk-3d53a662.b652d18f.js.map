{"version":3,"sources":["webpack:///./src/views/login/index.vue?7448","webpack:///src/views/login/index.vue","webpack:///./src/views/login/index.vue?e0c5","webpack:///./src/views/login/index.vue","webpack:///./src/api/user.js","webpack:///./src/views/login/index.vue?a08b"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","attrs","ref","model","value","user","callback","$$v","$set","expression","slot","on","getverity","verityvalue","_v","_s","backverify","onLogin","staticRenderFns","name","data","mobile","code","isCountDownShow","methods","component","getUsersLogin","request","url","method","getUserInfo","getAutherUserInfo","id","getPersonUserxInfo","updateUserPhoto","updateUserProfile"],"mappings":"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","file":"js/chunk-3d53a662.b652d18f.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"login\"},[_c('van-nav-bar',{attrs:{\"title\":\"登录\"}}),_c('div',{staticClass:\"login-field\"},[_c('ValidationObserver',{ref:\"myform\"},[_c('ValidationProvider',{attrs:{\"name\":\"手机号\",\"rules\":\"required|mobile\",\"immediate\":\"\"}},[_c('van-field',{attrs:{\"placeholder\":\"请输入用户名/手机号/邮箱\",\"left-icon\":\"user-o\"},model:{value:(_vm.user.mobile),callback:function ($$v) {_vm.$set(_vm.user, \"mobile\", $$v)},expression:\"user.mobile\"}})],1),_c('ValidationProvider',{attrs:{\"name\":\"验证码\",\"rules\":\"required|code\",\"immediate\":\"\"}},[_c('van-field',{attrs:{\"placeholder\":\"请输入验证码\"},model:{value:(_vm.user.code),callback:function ($$v) {_vm.$set(_vm.user, \"code\", $$v)},expression:\"user.code\"}},[_c('van-icon',{attrs:{\"slot\":\"left-icon\",\"class-prefix\":\"icont\",\"name\":\"mima\"},slot:\"left-icon\"}),(_vm.isCountDownShow)?_c('van-button',{attrs:{\"slot\":\"button\",\"size\":\"small\",\"type\":\"primary\"},on:{\"click\":_vm.getverity},slot:\"button\",model:{value:(_vm.verityvalue),callback:function ($$v) {_vm.verityvalue=$$v},expression:\"verityvalue\"}},[_vm._v(_vm._s(_vm.verityvalue))]):_c('van-count-down',{attrs:{\"slot\":\"button\",\"time\":6 * 1000,\"format\":\"ss 秒后重新获取\"},on:{\"finish\":_vm.backverify},slot:\"button\"})],1)],1)],1)],1),_c('div',{staticClass:\"loginBtn\"},[_c('van-button',{attrs:{\"type\":\"info\"},on:{\"click\":_vm.onLogin}},[_vm._v(\"登录\")])],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <div class=\"login\">\r\n    <!--引入导航 -->\r\n    <van-nav-bar title=\"登录\" />\r\n    <!--引入输入框-->\r\n    <div class=\"login-field\">\r\n      <!--\r\n      表单验证\r\n      1、使用 ValidationObserver 组件把需要验证的整个表单包起来\r\n      2、使用 ValidationProvider 组件把具体的表单元素包起来，例如 input\r\n         name   配置字段的提示名称\r\n         rules  配置校验规则\r\n         v-slot=\"{ errors }\" 获取校验失败的错误提示消息\r\n      -->\r\n      <ValidationObserver ref=\"myform\">\r\n        <ValidationProvider name=\"手机号\" rules=\"required|mobile\" immediate >\r\n          <van-field placeholder=\"请输入用户名/手机号/邮箱\" left-icon=\"user-o\" v-model=\"user.mobile\"></van-field>\r\n        </ValidationProvider>\r\n        <ValidationProvider name=\"验证码\" rules=\"required|code\" immediate >\r\n          <van-field placeholder=\"请输入验证码\" v-model=\"user.code\">\r\n            <van-icon slot=\"left-icon\" class-prefix=\"icont\" name=\"mima\" />\r\n            <van-button\r\n              v-if=\"isCountDownShow\"\r\n              v-model=\"verityvalue\"\r\n              slot=\"button\"\r\n              size=\"small\"\r\n              type=\"primary\"\r\n              @click=\"getverity\"\r\n            >{{verityvalue}}</van-button>\r\n            <van-count-down\r\n              v-else\r\n              slot=\"button\"\r\n              :time=\"6 * 1000\"\r\n              @finish=\"backverify\"\r\n              format=\"ss 秒后重新获取\"\r\n            />\r\n          </van-field>\r\n        </ValidationProvider>\r\n      </ValidationObserver>\r\n    </div>\r\n    <div class=\"loginBtn\">\r\n      <van-button type=\"info\" @click=\"onLogin\">登录</van-button>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { getUsersLogin, getverity } from '@/api/user'\r\nimport { validate } from 'vee-validate' // 引入自定义校验规则\r\nexport default {\r\n  name: 'login',\r\n  data () {\r\n    return {\r\n      user: {\r\n        mobile: '',\r\n        code: ''\r\n      },\r\n      isCountDownShow: true,\r\n      verityvalue: '点击获取'\r\n    }\r\n  },\r\n  methods: {\r\n    // 用户登录\r\n    async onLogin () {\r\n      // 手动触发校验\r\n      let result = await this.$refs.myform.validate() // 异步转为同步(result为boolen值)\r\n      if (!result) {\r\n        // 不存在时执行返回\r\n        const errors = this.$refs.myform.errors // 获取错误返回对象\r\n        for (let key in errors) {\r\n          const item = errors[key]\r\n          if (item[0]) {\r\n            this.$toast(item[0]) // 当符合条件时返回错误提示信息\r\n            return // 符合条件时返回\r\n          }\r\n        }\r\n      } else {\r\n        // 存在时执行以下代码\r\n\r\n        // 使用轻提示\r\n        this.$toast.loading({\r\n          duration: 0, // 持续时间，0表示持续展示不停止\r\n          forbidClick: true, // 是否禁止背景点击\r\n          message: '登录中...' // 提示消息\r\n        })\r\n        try {\r\n        // 1,获取数据\r\n          const user = this.user\r\n          // 2，请求参数\r\n          let result = await getUsersLogin(user)\r\n          // 3，返回数据\r\n          console.log('成功', result)\r\n\r\n          // 4，Vuex 存储Token 提交监听事件  传递数据 存储token数据\r\n          this.$store.commit('setuser', result.data.data)\r\n          this.$toast.success('登录成功')\r\n          // 如果有 redirect 则跳转到来源页，没有就跳转到首页\r\n          const redirect = this.$route.query.redirect || '/'\r\n          this.$router.push(redirect)\r\n          // const redirect = this.$route.query.redirect || '/'\r\n          // this.$router.push(redirect)\r\n        } catch (error) {\r\n          console.log('失败', error)\r\n          this.$toast.fail('用户名或密码错误')\r\n        }\r\n      }\r\n    },\r\n    // 获取验证码\r\n    async getverity () {\r\n      // 获取手机号\r\n      const { mobile } = this.user\r\n      // 验证手机号是否存在\r\n\r\n      const validateResult = await validate(mobile, 'required|mobile', {\r\n        name: '手机号'\r\n      })\r\n      // 参数1：要验证的数据\r\n      // 参数2：验证规则\r\n      // 参数3：一个可选的配置对象，例如配置错误消息字段名称 name\r\n      // 返回值：{ valid, errors, ... }\r\n      //          valid: 验证是否成功，成功 true，失败 false\r\n      //          errors：一个数组，错误提示消息\r\n\r\n      // 如果验证失败，提示错误消息，停止发送验证码\r\n      if (!validateResult.valid) {\r\n        this.$toast(validateResult.errors[0])\r\n        return\r\n      }\r\n      // 隐藏标签\r\n      this.isCountDownShow = false\r\n\r\n      // 请求数据\r\n      try {\r\n        let result = await getverity(mobile)\r\n        console.log('成功', result)\r\n      } catch (error) {\r\n        if (error.response.status === 429) {\r\n          this.$toast('请勿频繁发送')\r\n        } else {\r\n          this.$toast.fail('发送失败')\r\n        }\r\n      }\r\n    },\r\n    // 倒计时结束执行\r\n    backverify () {\r\n      this.isCountDownShow = true\r\n      this.verityvalue = '重新获取验证码'\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.login-field {\r\n  margin-top: 20px;\r\n  .van-cell {\r\n    height: 50px;\r\n    padding: 10px 20px;\r\n    align-items: center;\r\n    .login-btn {\r\n      width: 100%;\r\n    }\r\n  }\r\n}\r\n.loginBtn {\r\n  margin-top: 20px;\r\n  padding: 27px 16px;\r\n  .van-button {\r\n    width: 100%;\r\n    background-color: #6db4fb;\r\n  }\r\n}\r\n</style>\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./index.vue?vue&type=template&id=39b6cfee&scoped=true&\"\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\nimport style0 from \"./index.vue?vue&type=style&index=0&id=39b6cfee&lang=less&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"39b6cfee\",\n  null\n  \n)\n\nexport default component.exports","// 用户登录注册涉及到的接口\r\nimport request from '@/utils/request-axios'\r\n\r\n// 用户登录接口\r\nexport const getUsersLogin = data => {\r\n  return request({\r\n    url: '/app/v1_0/authorizations',\r\n    method: 'post', // 请求方式\r\n    data\r\n  })\r\n}\r\n// 获取验证码接口\r\nexport const getverity = mobile => {\r\n  return request({\r\n    url: `/app/v1_0/sms/codes/${mobile}`,\r\n    method: 'get' // 请求方式\r\n  })\r\n}\r\n// 获取个人信息接口\r\nexport const getUserInfo = () => {\r\n  return request({\r\n    url: '/app/v1_0/user',\r\n    method: 'get' // 请求方式\r\n  })\r\n}\r\n\r\n// 获取用户信息接口\r\nexport const getAutherUserInfo = (id) => {\r\n  return request({\r\n    url: `/app/v1_0/users/${id}`,\r\n    method: 'get'// 请求方式\r\n  })\r\n}\r\n\r\n// 获取个人用户信息\r\nexport const getPersonUserxInfo = () => {\r\n  return request({\r\n    url: `/app/v1_0/user/profile`,\r\n    method: 'get'// 请求方式\r\n  })\r\n}\r\n\r\n// 获取用户资料\r\nexport const updateUserPhoto = data => {\r\n  return request({\r\n    method: 'PATCH',\r\n    url: '/app/v1_0/user/photo',\r\n    data\r\n  })\r\n}\r\n\r\n// 更新用户资料\r\nexport const updateUserProfile = data => {\r\n  return request({\r\n    method: 'PATCH',\r\n    url: '/app/v1_0/user/profile',\r\n    data\r\n  })\r\n}\r\n","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=style&index=0&id=39b6cfee&lang=less&scoped=true&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=style&index=0&id=39b6cfee&lang=less&scoped=true&\""],"sourceRoot":""}